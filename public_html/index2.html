<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript"
			src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet"
		href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
		<script
			src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script
			src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
		<link href="mycss.css" type="text/css" rel="stylesheet" />

		<title>Welcome to Geyword</title>

		<!--Parse the url and get the query string-->
		<!--Click on the button to show result on the current page-->
		<script>
			function getparm1() 
			{ 
				var url=location.href; 

				// normal acess
				if(url.slice(-4)=="html")
				return "";

				var tmp1=url.split("?")[1]; 
				var tmp2=tmp1.split("&")[0]; 
				var tmp3=tmp2.split("=")[1]; 
				var parm1=tmp3; 
				return parm1; 
			};



			function injetTables(data_file) {
				//var people = [];
				console.log(data_file);
				$.ajax({
					//type:"GET", 
					url: data_file, 
					dataType: 'json',
					contentType: "application/json",
					crossDomain: true,
					success: function(data) {
						$("#mypanel1").css("visibility", "visible");
						$("#mypanel2").css("visibility", "visible");
						$("#userdata").css("visibility", "visible");
						$("#userdata2").css("visibility", "visible");
						$("#userdata tbody").empty();
						$("#userdata2 tbody").empty();

						if(data.searchResult) {

							$.each(data.searchResult, function(i,f1) {
								var tblRow = "<tr>" +"<td>" + f1.keyword + "</td>"+ "<td>" + f1.record + "</td>" +
									"<td>" + f1.column + "</td>" + "<td>" + f1.table + "</td>" + "<td>" + f1.database + "</td>"+ "<td class=\"col-md-2\"><a href=\showtable.html?table=" + f1.table + ">" + "Show Table" +"</a> <a href=\"#\">"+ "Visualization"+"</a></td><td>"+ f1.ID+"</td></tr>";
								$(tblRow).appendTo("#userdata tbody");
							});
						}
						if(data.join) {
							$.each(data.join, function (i, f2) {
								var tblRow = "<tr>" + "<td class=\"col-md-1\">" + f2.rank + "</td>" + "<td>" + f2.cost + "</td></tr>" +
								"<tr><td>Tables </td><td>"+ f2.tables+"</td></tr>" +
								"<tr><td>Relations </td><td>" + f2.relations + "</td>" + "</tr>"
								$(tblRow).appendTo("#userdata2 tbody");
							});
						}
					},
					error: function (jqXHR, textStatus, errorThrown) {
						$("#userdata").css("visibility", "hidden");
						$("#userdata2").css("visibility", "hidden");
						$("#mypanel1").css("visibility", "hidden");
						$("#mypanel2").css("visibility", "hidden");
						//alert(textStatus);
					},
				});

			};

			$(document).ready(function()  { 

				var initialvar = getparm1();
				if(initialvar != "") {
					var data_file = "http://54.174.121.196:7654/Join/"+initialvar;
					injetTables(data_file);
				}
				// String='neo4j.json';
				$('#MyButton').click(function(){
					var data_file = "http://54.174.121.196:7654/Join/"+document.getElementById('mytext').value.toString();
					injetTables(data_file);

				});
			});

		</script>
	</head>

	<!--This is the start of body-->
	<body>
		<nav class="navbar navbar-default">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href='index.html'>
					<img class="logo" alt="Geyword" src="images/logos.png"/>
				</a>


				<form class="navbar-form navbar-left" role="search">
					<div class="form-group" id="search-bar">

						<input type="text" id='mytext' align="center" class="form-control">
						<button type="button"  id="MyButton" class="btn btn-default" >Search</button>

					</div>
				</form>

			</div>
		</div>
		</nav>

			<div class="col-lg-10 col-md-offset-1">
			<div class="panel panel-default" style="visibility:hidden" id="mypanel1">
			<div class="panel-heading"> <h1>GeyWord Results</h1></div>
			<table id= "userdata" class="table table-striped" style="visibility:hidden">

				<thead>
					<tr>
						<td>Keyword</td>
						<td>Record</td>
						<td>Column</td>
						<td>Table</td>
						<td>Database</td>
						<td>Database ID</td>
					</tr>
				</thead>
				<tbody>

				</tbody>
			</table>

			</div>

			<div class="clearfix"></div>
			<div class="clearfix"></div>

			<div class="panel panel-default" style="visibility:hidden" id="mypanel2">
				<div class="panel-heading"> <h1>GeyWord Relations</h1></div>

			<table id= "userdata2" class="table table-striped" style="visibility:hidden">

				<thead>
					<tr>
						<td class="col-md-1">Rank</td>
						<td>Cost</td>
						
					</tr>
				</thead>
				<tbody>

				</tbody>
			</table>
			</div>
			</div>


	</body>
</html>

